<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
`caas-campaign-incentives`
Polymer Campaign Incentives Element for Crowdfunding as a Service Solutions

@demo demo/index.html 
-->

<dom-module id="caas-campaign-incentives">
  <template>

    <iron-ajax
      id="getCampaignIncentives"
      url="[[apiEndpoint]]/campaigns/[[campaignId]]/incentives"
      handle-as="json"
      method="GET"
      last-response="{{_apiData}}"
      debounce-duration="3000"
      auto
    ></iron-ajax>

  </template>

  <script>
    Polymer({

      is: 'caas-campaign-incentives',

      properties: {

        apiEndpoint: {
          type: String,
          value: null
        },

        campaignId: {
          type: String,
          value: null
        },

        incentives: {
          type: Array,
          computed: '_computeIncentives(_apiData.*)',
          notify: true
        },

        _apiData: {
          type: Array
        }

      },

      _computeIncentives: function(apiDataChange) {
        var apiData = apiDataChange.base;
        return apiData.map(this._parseApiDataItemToIncentive)
      },

      _parseApiDataItemToIncentive: function(apiDataItem) {
        return {
          message: apiDataItem.message,
          minimumInvestment: apiDataItem.minimumInvestment,
          costs: apiDataItem.costs,
          forBusiness: apiDataItem.forBusiness,
          investorCount: apiDataItem.investorCount,
          hasInvestors: apiDataItem.hasInvestors,
          inStock: apiDataItem.inStock,
          hasStock: apiDataItem.hasStock,
          currentStock: apiDataItem.currentStock,
          available: apiDataItem.available,
          id: apiDataItem.id,
          contractTypeId: apiDataItem.contractTypeId
        }
      }

    });
  </script>
</dom-module>
